/*magicform*/!function(){function p(t,g){return(/string|function/.test(typeof g)?e:a)(t,g)}function s(a,g){return"string"!=typeof a&&(g=typeof a,"number"===g?a+="":a="function"===g?s(a.call(a)):""),a}function u(a){return n[a]}function a(a,g){var f=p.get(a)||b({filename:a,name:"Render Error",message:"Template not found"});return g?f(g):f}function e(a,g){if("string"==typeof g){var v=g;g=function(){return new f(v)}}var m=k[a]=function(f){try{return new g(f,a)+""}catch(c){return b(c)()}};return m.prototype=g.prototype=
r,m.toString=function(){return g+""},m}function b(a){var g=a.stack||"";if(g)g=g.split("\n").slice(0,2).join("\n");else for(var f in a)g+="<"+f+">\n"+a[f]+"\n\n";return function(){return"object"==typeof console&&console.error("{Template Error}\n\n"+g),"{Template Error}"}}var k=p.cache={},f=this.String,n={"<":"&#60;",">":"&#62;",'"':"&#34;","'":"&#39;","&":"&#38;"},l=Array.isArray||function(a){return"[object Array]"==={}.toString.call(a)},r=p.utils={$helpers:{},$include:function(t,g,f){var m=t,h=/(\/)[^/]+\1\.\.\1/;
f=("./"+f).replace(/[^/]+$/,"")+m;for(f=f.replace(/\/\.\//g,"/");f.match(h);)f=f.replace(h,"/");return t=f,a(t,g)},$string:s,$escape:function(a){return s(a).replace(/&(?![\w#]+;)|[<>"']/g,u)},$each:function(a,g){if(l(a))for(var f=0,m=a.length;m>f;f++)g.call(a,a[f],f,a);else for(f in a)g.call(a,a[f],f)}},q=p.helpers=r.$helpers;p.get=function(a){return k[a.replace(/^\.\//,"")]};p.helper=function(a,g){q[a]=g};"function"==typeof define?define(function(){return p}):"undefined"!=typeof exports?module.exports=
p:this.template=p;p("formArrayControlItemTemplate",function(a){var g=(this.$helpers,this.$string),b=a.controlTemplate;a=a.editable;var m="";return m+='<br/> <span class="form-array-li"> ',m+=g(b),m+=" ",a&&(m+=' <a href="javascript:;" class="form-icon form-item-remove" title="\u79fb\u9664"><i class="mf-iconfont">&#xf0153;</i></a> '),m+=" </span>",new f(m)});p("formArrayTemplate",function(a){var g=(this.$helpers,this.$escape),b=a.data,m=a.editable,h=a.p,c=a.newTemplate,d=a.notNew,k=this.$string;a=
a.arrayTemplate;var e="";return e+='<span class="form-array-ul formitem-control ',e+=g(b.classname),e+='" type="array"> ',m&&(e+=' <a href="javascript:;" class="form-icon form-item-add" title="\u65b0\u589e" data-p="',e+=g(h),e+='" data-newtemplate="',e+=g(c),e+='"><i class="mf-iconfont">&#xf0154;</i></a> '),e+=" ",d&&(e+=" ",e+=k(a),e+=" "),e+=" </span>",new f(e)});p("formControlCheckboxTemplate",function(a){var g=(this.$helpers,this.$escape),e=a.data,m=this.$each,h=(a.op,a.$index,a.listitem),c="";
return c+='<span class="formitem-control ',c+=g(e.classname),c+=' formitem-checkbox" type="checkbox" data-order="',c+=g(e.order),c+='"> ',m(e.options,function(a){c+=' <input data-listitem="';c+=g(h);c+='" class="formitem-checkbox" placeholder="';c+=g(a.placeholder);c+='" ';c+=g(a.disabled);c+=" ";c+=g(a.validation);c+=" ";c+=g(a.attr);c+=" ";c+=g(a.flag);c+=' checked="';c+=g(a.checked);c+='" ';c+=g(a.status);c+=' type="checkbox" id="formitem-radio-';c+=g(a.label.title);c+='"><label class="formitem-checkbox-label" for="formitem-radio-';
c+=g(a.label.title);c+='" ';c+=g(a.label.attr);c+=">";c+=g(a.label.title);c+="</label> "}),c+=" </span>",new f(c)});p("formControlHashTemplate",function(a){var g=(this.$helpers,this.$string),e=a.keyControlTemplate;a=a.controlTemplate;var m="";return m+='<span class="form-array-li w45p">',m+=g(e),m+='</span> <span class="form-array-li w45p">',m+=g(a),m+="</span>",new f(m)});p("formControlInputConfigTemplate",function(a){var g=(this.$helpers,this.$escape),e=a.listitem,m=a.p,h=a.data,c=a.options;a=a.flag;
var d="";return d+='<input data-listitem="',d+=g(e),d+='" id="formitem-',d+=g(m),d+='" class="formitem-control formitem-input ',d+=g(h.classname.control),d+='" style="',d+=g(h.style.control),d+='" placeholder="',d+=g(h.placeholder),d+='" ',d+=g(c.status),d+=" ",d+=g(h.validation),d+=' data-flag="',d+=g(a),d+='" ',d+=g(h.disabled),d+=" ",d+=g(h.attr),d+=' data-order="',d+=g(h.order),d+='" type="',d+=g(h.control),d+='" value="',d+=g(h.value),d+='">',new f(d)});p("formControlInputTemplate",function(a){var g=
(this.$helpers,this.$escape),e=a.listitem,m=a.p,h=a.data,c=a.options;a=a.flag;var d="";return d+='<input data-listitem="',d+=g(e),d+='" id="formitem-',d+=g(m),d+='" class="formitem-control formitem-input ',d+=g(h.classname),d+='" style="',d+=g(h.style),d+='" ',d+=g(c.status),d+=' data-flag="',d+=g(a),d+='" placeholder="',d+=g(h.placeholder),d+='" ',d+=g(h.validation),d+=" ",d+=g(h.attr),d+=' value="',d+=g(h.value),d+='" type="',d+=g(h.control),d+='">',new f(d)});p("formControlObjectTemplate",function(a){var g=
(this.$helpers,this.$escape),e=a.p;a=a.stringifyVal;var m="";return m+='<a href="javascript:;" class="form-icon form-item-detail formitem-control" for="formitem-',m+=g(e),m+='" data-mf-val="',m+=g(a),m+='" title="\u8be6\u7ec6\u8bbe\u5b9a"><i class="mf-iconfont">&#xf00e1;</i></a>',new f(m)});p("formControlRadioTemplate",function(a){var g=(this.$helpers,this.$escape),e=a.data,m=this.$each,h=(a.op,a.$index,a.listitem),c="";return c+='<span class="formitem-control ',c+=g(e.classname),c+=' formitem-radio" type="radio" data-order="',
c+=g(e.order),c+='"> ',m(e.options,function(a){c+=' <input type="radio" class="formitem-radio" data-listitem="';c+=g(h);c+='" placeholder="';c+=g(a.placeholder);c+='" data-flag="';c+=g(a.flag);c+='" ';c+=g(a.validation);c+=" ";c+=g(a.disabled);c+=" ";c+=g(a.attr);c+=" ";c+=g(a.checked);c+=" ";c+=g(a.status);c+=' data-order="';c+=g(e.order);c+='" name="';c+=g(e.name);c+='" id="formitem-radio-';c+=g(a.label.title);c+='"><label class="formitem-radio-label" for="formitem-radio-';c+=g(a.label.title);c+=
'" ';c+=g(a.label.attr);c+=">";c+=g(a.label.title);c+="</label> "}),c+=" </span>",new f(c)});p("formControlSelectTemplate",function(a){var g=(this.$helpers,this.$escape),e=a.listitem,m=a.p,h=a.data,c=a.options,d=this.$each,b=(a.op,a.$index,"");return b+='<select data-listitem="',b+=g(e),b+='" id="formitem-',b+=g(m),b+='" class="formitem-control formitem-select ',b+=g(h.classname),b+='" style="',b+=g(h.style),b+='" ',b+=g(h.validation),b+=" ",b+=g(c.status),b+=" ",b+=g(h.disabled),b+=" ",b+=g(h.attr),
b+=' data-order="',b+=g(h.order),b+='"> ',d(h.options,function(a){b+=" ";a.group?(b+=" ",a.firstgroup||(b+=" </optgroup> "),b+=' <optgroup label="',b+=g(a.text),b+='" class="formitem-selectoption formitem-selectoptiongroup"> '):(b+=' <option value="',b+=g(a.val),b+='" class="formitem-selectoption" ',b+=g(a.attr),b+=">",b+=g(a.text),b+="</option> ");b+=" "}),b+=" </select>",new f(b)});p("formControlTemplate",function(a){var g=(this.$helpers,a.hasCloseTag),b=this.$escape,e=a.options,h=this.$string;
a=a.labelTemplate;var c="";return g&&(c+=" </div> "),c+=' <div class="form-group ',c+=b(e.classname.itemwrapper),c+='" style="',c+=b(e.style.itemwrapper),c+='"> ',c+=h(a),new f(c)});p("formControlTextareaTemplate",function(a){var g=(this.$helpers,this.$escape),b=a.listitem,e=a.p,h=a.data,c=a.options;a=a.flag;var d="";return d+='<textarea data-listitem="',d+=g(b),d+='" id="formitem-',d+=g(e),d+='" class="formitem-control formitem-input ',d+=g(h.classname),d+='" style="',d+=g(h.style),d+='" ',d+=g(c.status),
d+=' placeholder="',d+=g(h.placeholder),d+='" data-flag="',d+=g(a),d+='" ',d+=g(h.validation),d+=" ",d+=g(h.disabled),d+=" ",d+=g(h.attr),d+=' data-order="',d+=g(h.order),d+='" type="',d+=g(h.control),d+='">',d+=g(h.value),d+="</textarea>",new f(d)});p("formLabelTemplate",function(a){var g=(this.$helpers,this.$escape),b=a.data;a=a.p;var e="";return e+='<label class="formitem-label ',e+=g(b.label.classname),e+='" style="',e+=g(b.label.style),e+='" for="formitem-',e+=g(a),e+='" data-key="',e+=g(a),
e+='" ',e+=g(b.label.attr),e+=">",e+=g(b.label.title),e+="</label>",new f(e)});p("formPanelTemplate",function(a){var g=(this.$helpers,this.$escape),b=a.options,e=this.$each,h=(a.op,a.$index,"");return h+='</div> <div class="',h+=g(b.formpanel.classname),h+='"> <label class="formitem-label ',h+=g(b.label.classname),h+='" style="',h+=g(b.label.style),h+='" ',h+=g(b.attr.label),h+="></label> ",e(b.buttons,function(a){h+=" ";a.submit?(h+=' <button class="',h+=g(a.className),h+='" title="',h+=g(a.title),
h+='">',h+=g(a.name),h+="</button> "):(h+=' <button class="ml15 ',h+=g(a.className),h+='" title="',h+=g(a.title),h+='">',h+=g(a.name),h+="</button> ");h+=" "}),h+=" </div>",new f(h)})}();"use strict";
(function(p){var s=function(){return{extend:function(a,e){for(var b in e)a[b]=e[b];return a},getElementsByClassName:function(a,e,b){b||(b=document);e||(e="*");var k=[];e=b.getElementsByTagName(e);a=new RegExp("(^|\\s+)"+a+"(\\s+|$)","g");b=0;for(var f=e.length;b<f;b++){var n=e[b];a.test(n.className)&&(k.push(n),a.lastIndex=0)}return k},_typeof:function(a){return/\[object\s(\w*)\]/i.exec(Object.prototype.toString.call(a))[1]},createElementsWithTemplate:function(a){var e=document.createElement("div");
e.innerHTML=a;return e.children}}}(),u=function(){return{DEFAUTLBUTTONS:[{name:"\u63d0\u4ea4",title:"\u63d0\u4ea4\u8868\u5355",className:"primary",submit:!0},{name:"\u53d6\u6d88",title:"\u53d6\u6d88",className:"normal"}],_setOptions:function(a){a=a||{};a.buttons||(a.buttons=magicform.DEFAUTLBUTTONS.concat());a.status=a.status||"disabled";a.functions=a.functions||["editable"];a.style=a.style||"";a.classname=a.classname||"w70p";a.attr=a.attr||"";a.label=a.label||{};a.label.style=a.label.style||"";a.label.classname=
a.label.classname||"w20p align-right mr10p";a.label.attr=a.label.attr||"";a.itemwrapper=a.itemwrapper||{};a.itemwrapper.style=a.itemwrapper.style||"";a.itemwrapper.classname=a.itemwrapper.classname||"";a.itemwrapper.attr=a.itemwrapper.attr||"";a.formpanel=a.formpanel||{};a.formpanel.style=a.formpanel.style||"";a.formpanel.classname=a.formpanel.classname||"form-panel mt30";a.formpanel.attr=a.formpanel.attr||"";a.array=a.array||{};a.attr=a.attr||{};return a},_predefineValue:function(a,e,b){var k=Object.prototype.toString,
f=0;a.label=a.label||{};a.label.title=a.label.title||e;a.label.classname=a.label.classname||b.label.classname||"w20p align-right mr10p";a.label.style=a.label.style||b.label.style||"";a.classname=a.classname||b.classname||"w70p";a.style=a.style||b.style||"";a.placeholder=a.placeholder||b.placeholder||"";if(a.options)for(var n=!1,f=0;f<a.options.length;f++)!n&&a.options[f].group&&(n=a.options[f].firstgroup=!0);if(/array/i.test(k.call(a)))for(f=0;f<a.length;f++)/object/i.test(typeof a[f])||(a[f]={value:a[f],
mf:1},this._predefineValue(a[f],e,b));return a},_translateLabel:function(a,e,b,k){var f="",f="",f=template("formLabelTemplate")({data:a,p:b});k.label.tmplprocess&&(f=k.label.tmplprocess(f));return f=template("formControlTemplate")({data:a,hasCloseTag:e,options:k,labelTemplate:f})},_translateControl:function(a,e,b,k,f){var n=Object.prototype.toString,l="",l="",l={text:"Input",checkbox:"Checkbox",radio:"Radio",select:"Select",textarea:"Textarea"}[a.control]||"Input";if(a.hash)l=template("formControl"+
l+"Template")({data:a,p:b,options:k,listitem:"listitem"}),k.tmplprocess&&(l=k.tmplprocess(l)),l=template("formControlHashTemplate")({keyControlTemplate:this._translateControl(a.key,e,b,k,"listitem"),controlTemplate:l});else if(/array/i.test(n.call(a))){f="editable"===k.status||"new"===k.status;for(var n="new"!==k.status,l=encodeURIComponent(JSON.stringify(a.filter(function(a){if(a.fornew)return a})[0])),r="",q=a.filter(function(a){if(!a.fornew)return a}),p=q.length-1;0<=p;p--)r+=template("formArrayControlItemTemplate")({controlTemplate:this._translateControl(q[p],
e,b,k,"listitem"),editable:f});l=template("formArrayTemplate")({data:a,editable:f,notNew:n,newTemplate:l,arrayTemplate:r,p:b})}else"[object Object]"===n.call(a)&&!a.mf||a&&a.isobject?l=template("formControlObjectTemplate")({p:b,stringifyVal:encodeURIComponent(JSON.stringify(a))}):(l=template("formControl"+l+"Template")({data:a,p:b,options:k,listitem:f}),k.tmplprocess&&(l=k.tmplprocess(l)));return l},_translateJson:function(a,e,b){var k="",f="",f=0,n;for(n in e){var l=e[n].p,r=a[l],q=!1;0===f?q=!1:
r.inline||(q=!0);k+=this._translateLabel(r,q,l,b);k+=this._translateControl(r,q,l,b);f++}f=template("formPanelTemplate")({options:b});b.formpanel.tmplprocess&&(f=b.formpanel.tmplprocess(f));!b.hasbuttons||"editable"!==b.status&&"new"!==b.status||(k+=f);return k},generate:function(a,e,b){a.innerHTML=this.json2html(e,b);this.init(a,e,b);return this},json2html:function(a,e){var b=[],k=null;e=this._setOptions(e);for(k in a)"object"!==typeof a[k]&&(a[k]={value:a[k],mf:1}),this._predefineValue(a[k],k,e),
b.push({p:k,order:a[k].order});b=b.sort(function(a,b){if(null===a.order||void 0===a.order||""===a.order)a.order=100;if(null===b.order||void 0===b.order||""===b.order)b.order=100;if(a.order>b.order)return!0;if(a.order<b.order)return!1});return this._translateJson(a,b,e)},attach:function(a,e){var b=s.extend({},a),k=function(e,f,k){null!=k?e.attaproc?b[f][k]=e.attaproc(e,f,a,k):(a[f][k]&&(e.value=a[f][k]),b[f][k]=e):e.attaproc?b[f]=e.attaproc(e,f,a):(a[f]&&(e.value=a[f]),b[f]=e)},f;for(f in b)if(void 0!==
e[f]){var n=0;if(/array/i.test(s._typeof(e[f])))for(var l=0;l<e[f].length;l++)e[f][l].fornew?(b[f].push(e[f][l]),n++):k(e[f][l],f,l-n);else k(e[f],f)}return b},detach:function(a,e){var b={},k=function(a,b,f,k){null!=k?(a[f]=a[f]||[],e[f][n].detaproc?a[f].push(e[f][n].detaproc(f,b,k)):a[f].push(b.value)):e[f]&&e[f].detaproc?a[f]=e[f].detaproc(f,b,k):b.mf?a[f]=b.value||"":/object/i.test(s._typeof(b))&&(a[f]=b)},f;for(f in a)if(/array/i.test(s._typeof(a[f])))for(var n=0;n<a[f].length;n++)a[f][n].fornew||
k(b,a[f][n],f,n);else k(b,a[f],f);return b},_html2value:function(a){var e=null,b=null,k=null,f=0;if(a)if(/span/i.test(a.tagName))if(e=a.getAttribute("type"),"checkbox"===e||"radio"===e){for(var n=a.querySelectorAll("input"),k=a.querySelectorAll("label"),b=[],f=0;f<n.length;f++)b.push({label:k[f].innerHTML,checked:n[f].checked?"checked":"",disabled:n[f].disabled?"disabled":""});k=parseInt(a.getAttribute("data-order"),10);isNaN(k)&&(k=null);e={mf:1,control:e,name:n[0].name,options:b,order:k}}else for(b=
a.querySelectorAll(".formitem-control"),e=(e=a.querySelector(".form-item-add").getAttribute("data-newtemplate"))?[JSON.parse(decodeURIComponent(e))]:[],f=b.length-1;0<=f;f--)if(n=b[f],(k=b[f-1])&&"true"===k.getAttribute("data-flag")){var k=this._html2value(k),l=this._html2value(n);/string/i.test(typeof l)&&(l={value:l});l.mf=1;l.hash=1;l.key=k;l.control=n.getAttribute("type");k=parseInt(a.getAttribute("data-order"),10);isNaN(k)&&(k=null);l.order=k;l.disabled=n.disabled?"disabled":"";e.push(l);f--}else e.push(this._html2value(n));
else if(/\bselect\b/i.test(a.tagName))for(n=a.querySelectorAll(".formitem-selectoption"),b=[],f=0;f<n.length;f++)/optgroup/i.test(n[f])?b.push({val:"optgroup",text:n[f].getAttribute("label")}):b.push({val:n[f].value,text:n[f].innerHTML}),k=parseInt(a.getAttribute("data-order"),10),isNaN(k)&&(k=null),e={mf:1,control:"select",options:b,order:k,disabled:a.disabled?"disabled":""};else if(/\ba\b/i.test(a.tagName)){if(a=a.getAttribute("data-mf-val"))a=decodeURIComponent(a),e=JSON.parse(a)}else if(/\binput\b/i.test(a.tagName)||
/\btextarea\b/i.test(a.tagName))a.type?(k=parseInt(a.getAttribute("data-order"),10),isNaN(k)&&(k=null),e={mf:1,control:a.type,value:a.value,order:k,disabled:a.disabled?"disabled":""}):e=a.value;return e},html2json:function(a,e){for(var b=a.querySelectorAll(".form-group"),k={},f=0;f<b.length;f++){var n=b[f].querySelector(".formitem-label").getAttribute("data-key"),l=b[f].querySelector(".formitem-control");k[n]=this._html2value(l)}return k},init:function(a,e,b){b=this._setOptions(b);for(var k=this,
f=function(a){a.addEventListener("click",function(){var a=this.parentNode.parentNode;/form-array-li/i.test(this.parentNode.previousSibling.className)&&a.removeChild(this.parentNode.previousSibling.previousSibling);a.removeChild(this.parentNode.previousSibling);a.removeChild(this.parentNode)})},n=function(a){a.addEventListener("mouseover",function(){var a=this.querySelector(".form-item-remove");a&&(a.style.visibility="visible")});a.addEventListener("mouseout",function(){var a=this.querySelector(".form-item-remove");
a&&(a.style.visibility="hidden")});(a=a.querySelector(".form-item-remove"))&&f(a)},l=0,p=a.querySelectorAll(".form-array-ul"),l=0;l<p.length;l++){var q=p[l].querySelector(".form-item-add");q&&function(a,e){a.addEventListener("click",function(){var f="undefined"===a.getAttribute("data-newtemplate")?null:a.getAttribute("data-newtemplate"),h=a.getAttribute("data-p");if(f){for(var f=s.createElementsWithTemplate(template("formArrayControlItemTemplate")({editable:!0,controlTemplate:k._translateControl(JSON.parse(decodeURIComponent(f)),
!1,h,b,"listitem")})),h=e.querySelector("br"),c=null,d=null;f.length;)c=f[0],d||(d=c.querySelector("input")),e.insertBefore(f[0],h);d&&d.focus();c&&n(c)}})}(q,p[l])}p=a.querySelectorAll(".form-array-li");for(l=0;l<p.length;l++)n(p[l]);a=a.querySelectorAll(".form-item-detail");for(l=0;l<a.length;l++){var p=a[l].getAttribute("for").replace(/formitem-/,""),t=e[p];t.onclick&&a[l].addEventListener("click",function(){t.onclick.call(this,JSON.parse(decodeURIComponent(this.getAttribute("data-mf-val"))))})}return this}}}();
p.magicform=u})(window);
